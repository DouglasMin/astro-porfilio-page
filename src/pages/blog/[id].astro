---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getNotionBlogPosts } from '../../lib/notion';
import { marked } from 'marked';

export async function getStaticPaths() {
  const posts = await getNotionBlogPosts();
  return posts.map(post => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;

// HTML ì—”í‹°í‹° ë””ì½”ë”© í•¨ìˆ˜
function decodeHTMLEntities(text: string): string {
  const entities: Record<string, string> = {
    '&amp;': '&',
    '&lt;': '<',
    '&gt;': '>',
    '&quot;': '"',
    '&#39;': "'",
    '&nbsp;': ' ',
  };
  return text.replace(/&[#\w]+;/g, (entity) => entities[entity] || entity);
}

// ë””ë²„ê¹…: Mermaid ë¸”ë¡ í™•ì¸
if (import.meta.env.DEV && post.content.includes('mermaid')) {
  console.log('ğŸ” Mermaid ë¸”ë¡ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ì›ë³¸ ë§ˆí¬ë‹¤ìš´:');
  const mermaidMatch = post.content.match(/```mermaid[\s\S]*?```/gi);
  if (mermaidMatch) {
    console.log(mermaidMatch[0]);
  }
}

// Markdownì„ HTMLë¡œ ë³€í™˜
let htmlContent = await marked.parse(post.content);

// Mermaid ì½”ë“œ ë¸”ë¡ì„ íŠ¹ë³„íˆ í‘œì‹œ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´, HTML ì—”í‹°í‹° ë””ì½”ë”© í¬í•¨)
htmlContent = htmlContent.replace(
  /<pre><code class="language-mermaid">([\s\S]*?)<\/code><\/pre>/gi,
  (match, code) => {
    const decodedCode = decodeHTMLEntities(code.trim());
    return `<div class="mermaid-diagram"><div class="mermaid" data-mermaid-code="${decodeHTMLEntities(code.trim()).replace(/"/g, '&quot;')}">${decodedCode}</div></div>`;
  }
);

// í˜¹ì‹œ class ì—†ì´ ë‚˜ì˜¨ ê²½ìš°ë„ ì²˜ë¦¬ (Notionì´ ë‹¤ë¥´ê²Œ ë³€í™˜í•  ìˆ˜ ìˆìŒ)
htmlContent = htmlContent.replace(
  /<pre><code>```mermaid\n([\s\S]*?)```<\/code><\/pre>/gi,
  (match, code) => {
    const decodedCode = decodeHTMLEntities(code.trim());
    return `<div class="mermaid-diagram"><div class="mermaid" data-mermaid-code="${decodeHTMLEntities(code.trim()).replace(/"/g, '&quot;')}">${decodedCode}</div></div>`;
  }
);

// Notion callout íŒ¨í„´ ê°ì§€ ë° ë³€í™˜ (ë§ˆí¬ë‹¤ìš´ì—ì„œ > ë¡œ ì‹œì‘í•˜ëŠ” blockquoteë¥¼ calloutìœ¼ë¡œ ë³€í™˜)
htmlContent = htmlContent.replace(
  /<blockquote>\s*<p>([ğŸ’¡ğŸ””âš ï¸âœ…âŒğŸ“ŒğŸ’­ğŸ¯])\s*(.*?)<\/p>\s*<\/blockquote>/gs,
  '<div class="notion-callout"><div class="callout-icon">$1</div><div class="callout-text">$2</div></div>'
);
---

<BaseLayout title={post.title} description={post.description}>
  <!-- Mermaid.js for diagrams -->
  <script is:inline src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  
  <div class="progress-bar" id="progress-bar"></div>

  <article class="blog-post">
    <header class="post-header">
      <div class="header-container">
        <a href="/blog" class="back-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          ëª©ë¡ìœ¼ë¡œ
        </a>

        <div class="post-meta">
          <time datetime={post.publishedAt.toISOString()}>
            {post.publishedAt.toLocaleDateString('ko-KR', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
            })}
          </time>
          <span class="separator">â€¢</span>
          <span class="read-time">{Math.ceil(post.content.length / 500)}ë¶„ ì½ê¸°</span>
        </div>
        
        <h1 class="post-title">{post.title}</h1>
        
        {post.description && (
          <p class="post-description">{post.description}</p>
        )}
        
        {post.tags.length > 0 && (
          <div class="post-tags">
            {post.tags.map(tag => (
              <span class="tag">{tag}</span>
            ))}
          </div>
        )}
      </div>
    </header>

    <div class="post-content">
      <aside class="toc-sidebar" id="toc-sidebar">
        <div class="toc-sticky">
          <h3 class="toc-title">ëª©ì°¨</h3>
          <nav class="toc" id="toc"></nav>
        </div>
      </aside>

      <main class="post-body">
        <div class="prose" set:html={htmlContent} />
        
        <div class="post-author">
          <div class="author-avatar">ğŸ‘¨â€ğŸ’»</div>
          <div class="author-info">
            <h3>Dongik Min (Douglas)</h3>
            <p>í’€ìŠ¤íƒ ê°œë°œìë¡œ ì‚¬ìš©ì ê²½í—˜ì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•˜ë©° ê°œë°œí•©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </main>
    </div>

    <footer class="post-footer">
      <div class="footer-container">
        <div class="share-section">
          <h3>ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì—ˆë‚˜ìš”?</h3>
          <button class="share-btn" id="copy-link-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            ë§í¬ ë³µì‚¬
          </button>
        </div>

        <a href="/blog" class="back-to-list">â† ëª¨ë“  ê¸€ ë³´ê¸°</a>
      </div>
    </footer>
  </article>
</BaseLayout>

<script>
  function initBlogPost() {
    // Mermaid ì´ˆê¸°í™” ë° ë Œë”ë§
    if (typeof mermaid !== 'undefined') {
      const theme = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'default';
      
      mermaid.initialize({ 
        startOnLoad: false, // ìˆ˜ë™ìœ¼ë¡œ ì œì–´
        theme: theme,
        securityLevel: 'loose',
        fontFamily: 'var(--font-sans)',
        fontSize: 16,
        themeVariables: {
          darkMode: theme === 'dark',
          fontSize: '16px',
          primaryColor: '#3b82f6',
          primaryTextColor: theme === 'dark' ? '#f1f5f9' : '#1a202c',
          primaryBorderColor: '#60a5fa',
          lineColor: '#94a3b8',
          secondaryColor: '#8b5cf6',
          tertiaryColor: '#06b6d4',
        },
        flowchart: {
          curve: 'basis',
          padding: 20,
          nodeSpacing: 50,
          rankSpacing: 50,
        }
      });
      
      // ëª¨ë“  .mermaid ìš”ì†Œ ì°¾ê¸°
      const mermaidElements = document.querySelectorAll('.mermaid:not([data-processed])');
      
      if (mermaidElements.length > 0) {
        console.log(`ğŸ” Found ${mermaidElements.length} Mermaid diagrams to render`);
        
        mermaidElements.forEach(async (element, index) => {
          try {
            const id = `mermaid-${Date.now()}-${index}`;
            // data ì†ì„±ì—ì„œ ì›ë³¸ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°, ì—†ìœ¼ë©´ textContent ì‚¬ìš©
            let graphDefinition = element.getAttribute('data-mermaid-code') || element.textContent?.trim() || '';
            
            console.log(`ğŸ“Š Rendering diagram ${index + 1}:`, graphDefinition.substring(0, 50) + '...');
            
            if (graphDefinition) {
              // í˜¹ì‹œ ì›ë³¸ ì½”ë“œì— data ì†ì„±ì´ ì—†ì—ˆë‹¤ë©´ ì €ì¥
              if (!element.getAttribute('data-mermaid-code')) {
                element.setAttribute('data-mermaid-code', graphDefinition);
              }
              
              const { svg } = await mermaid.render(id, graphDefinition);
              element.innerHTML = svg;
              element.setAttribute('data-processed', 'true');
              console.log(`âœ… Diagram ${index + 1} rendered successfully`);
            }
          } catch (error) {
            console.error('âŒ Mermaid rendering error:', error);
            element.innerHTML = `<div style="color: #ef4444; padding: 1rem; border: 1px solid #ef4444; border-radius: 8px; background: rgba(239, 68, 68, 0.1);">
              <strong>âš ï¸ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ ì˜¤ë¥˜</strong><br>
              <small style="font-family: monospace;">${error.message || error}</small><br>
              <details style="margin-top: 0.5rem;">
                <summary style="cursor: pointer; color: #ef4444;">ì›ë³¸ ì½”ë“œ ë³´ê¸°</summary>
                <pre style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(0,0,0,0.1); border-radius: 4px; overflow-x: auto;">${element.getAttribute('data-mermaid-code') || element.textContent}</pre>
              </details>
            </div>`;
          }
        });
      }
    }

    // Progress Bar
    const progressBar = document.getElementById('progress-bar');
    if (progressBar) {
      window.addEventListener('scroll', () => {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight - windowHeight;
        const scrolled = window.scrollY;
        const progress = (scrolled / documentHeight) * 100;
        progressBar.style.width = `${progress}%`;
      });
    }

    // TOC ìƒì„±
    const prose = document.querySelector('.prose');
    const toc = document.getElementById('toc');
    const tocSidebar = document.getElementById('toc-sidebar');
    
    if (prose && toc) {
      const headings = prose.querySelectorAll('h2, h3');
      
      if (headings.length === 0) {
        if (tocSidebar) tocSidebar.style.display = 'none';
      } else {
        headings.forEach((heading, index) => {
          const id = `heading-${index}`;
          heading.id = id;
          
          const link = document.createElement('a');
          link.href = `#${id}`;
          link.textContent = heading.textContent;
          link.className = heading.tagName === 'H3' ? 'toc-link toc-link-sub' : 'toc-link';
          
          link.addEventListener('click', (e) => {
            e.preventDefault();
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
            history.pushState(null, '', `#${id}`);
          });
          
          toc.appendChild(link);
        });

        // Scroll Spy
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              toc.querySelectorAll('.toc-link').forEach(link => link.classList.remove('active'));
              const activeLink = toc.querySelector(`a[href="#${entry.target.id}"]`);
              if (activeLink) activeLink.classList.add('active');
            }
          });
        }, { rootMargin: '-100px 0px -66% 0px' });

        headings.forEach(h => observer.observe(h));
      }
    }

    // ì½”ë“œ ë³µì‚¬ ë²„íŠ¼
    document.querySelectorAll('.prose pre').forEach((pre) => {
      // ì´ë¯¸ ë²„íŠ¼ì´ ìˆìœ¼ë©´ ìŠ¤í‚µ
      if (pre.querySelector('.code-copy-btn')) return;
      
      const wrapper = document.createElement('div');
      wrapper.className = 'code-block-wrapper';
      pre.parentNode.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);
      
      const button = document.createElement('button');
      button.className = 'code-copy-btn';
      button.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
        <span>ë³µì‚¬</span>
      `;
      
      button.addEventListener('click', async () => {
        const code = pre.querySelector('code')?.textContent || pre.textContent;
        try {
          await navigator.clipboard.writeText(code);
          button.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>ë³µì‚¬ë¨!</span>
          `;
          button.classList.add('copied');
          setTimeout(() => {
            button.innerHTML = `
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <span>ë³µì‚¬</span>
            `;
            button.classList.remove('copied');
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      });
      
      wrapper.appendChild(button);
    });

    // ë§í¬ ë³µì‚¬ ë²„íŠ¼
    const copyLinkBtn = document.getElementById('copy-link-btn');
    if (copyLinkBtn) {
      copyLinkBtn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(window.location.href);
          const originalHTML = copyLinkBtn.innerHTML;
          copyLinkBtn.innerHTML = `
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            ë³µì‚¬ë¨!
          `;
          setTimeout(() => {
            copyLinkBtn.innerHTML = originalHTML;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy link:', err);
        }
      });
    }
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBlogPost);
  } else {
    initBlogPost();
  }

  // Astro í˜ì´ì§€ ì „í™˜ ì‹œì—ë„ ì‹¤í–‰
  document.addEventListener('astro:page-load', initBlogPost);

  // í…Œë§ˆ ë³€ê²½ ê°ì§€í•˜ì—¬ Mermaid ë‹¤ì‹œ ë Œë”ë§
  const themeObserver = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
        if (typeof mermaid !== 'undefined') {
          const theme = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'default';
          
          mermaid.initialize({ 
            startOnLoad: false,
            theme: theme,
            securityLevel: 'loose',
            fontFamily: 'var(--font-sans)',
            fontSize: 16,
            themeVariables: {
              darkMode: theme === 'dark',
              fontSize: '16px',
              primaryColor: '#3b82f6',
              primaryTextColor: theme === 'dark' ? '#f1f5f9' : '#1a202c',
              primaryBorderColor: '#60a5fa',
              lineColor: '#94a3b8',
              secondaryColor: '#8b5cf6',
              tertiaryColor: '#06b6d4',
            },
            flowchart: {
              curve: 'basis',
              padding: 20,
              nodeSpacing: 50,
              rankSpacing: 50,
            }
          });
          
          // ëª¨ë“  mermaid ë‹¤ì´ì–´ê·¸ë¨ ì°¾ê¸°
          const diagrams = document.querySelectorAll('.mermaid[data-processed]');
          diagrams.forEach(async (diagram, index) => {
            try {
              // ì›ë³¸ Mermaid ì½”ë“œë¥¼ data ì†ì„±ì— ì €ì¥í–ˆë‹¤ë©´ ê±°ê¸°ì„œ ê°€ì ¸ì˜¤ê¸°
              const originalCode = diagram.getAttribute('data-mermaid-code');
              if (originalCode) {
                const id = `mermaid-theme-${Date.now()}-${index}`;
                const { svg } = await mermaid.render(id, originalCode);
                diagram.innerHTML = svg;
              }
            } catch (error) {
              console.error('Mermaid theme update error:', error);
            }
          });
        }
      }
    });
  });

  themeObserver.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>

<style>
  /* Progress Bar */
  .progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--color-accent), #8b5cf6);
    z-index: 9999;
    width: 0%;
    transition: width 0.1s ease-out;
  }

  /* Blog Post Container */
  .blog-post {
    min-height: 100vh;
  }

  /* Header */
  .post-header {
    max-width: 768px;
    margin: 0 auto;
    padding: 3rem 1.5rem 2rem;
    text-align: center;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    margin-bottom: 2rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
    transition: all 0.2s;
  }

  .back-link:hover {
    color: var(--color-accent);
    background: var(--color-bg-secondary);
  }

  .header-container {
    animation: fadeIn 0.6s ease-out;
  }

  .post-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }

  .separator {
    opacity: 0.5;
  }

  .read-time {
    color: var(--color-accent);
    font-weight: 500;
  }

  .post-title {
    font-size: clamp(2rem, 5vw, 3rem);
    line-height: 1.2;
    margin-bottom: 1rem;
    color: var(--color-text);
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .post-description {
    font-size: 1.125rem;
    line-height: 1.6;
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
    max-width: 600px;
    margin-inline: auto;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
  }

  .tag {
    display: inline-block;
    padding: 0.375rem 0.875rem;
    background: var(--color-bg-secondary);
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
    border-radius: 9999px;
    font-size: 0.8125rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .tag:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  /* Main Content Layout */
  .post-content {
    max-width: 1280px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
    position: relative;
  }

  @media (min-width: 1024px) {
    .post-content {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 3rem;
      align-items: start;
    }
  }

  @media (min-width: 1280px) {
    .post-content {
      grid-template-columns: 1fr 768px 240px 1fr;
      gap: 2rem;
    }
  }

  /* TOC Sidebar */
  .toc-sidebar {
    display: none;
  }

  @media (min-width: 1024px) {
    .toc-sidebar {
      display: block;
    }
  }

  @media (min-width: 1280px) {
    .toc-sidebar {
      grid-column: 3;
    }
  }

  .toc-sticky {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
    padding: 1.5rem;
    background: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
  }

  .toc-title {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-secondary);
    margin-bottom: 1rem;
  }

  .toc {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .toc-link {
    display: block;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    padding: 0.375rem 0;
    border-left: 2px solid transparent;
    padding-left: 0.75rem;
    transition: all 0.2s;
    line-height: 1.4;
  }

  .toc-link-sub {
    padding-left: 1.5rem;
    font-size: 0.8125rem;
  }

  .toc-link:hover {
    color: var(--color-accent);
    border-left-color: var(--color-accent);
  }

  .toc-link.active {
    color: var(--color-accent);
    border-left-color: var(--color-accent);
    font-weight: 600;
  }

  /* Post Body */
  .post-body {
    min-width: 0;
  }

  @media (min-width: 1280px) {
    .post-body {
      grid-column: 2;
    }
  }

  /* Prose Styles */
  .prose {
    max-width: 100%;
    color: var(--color-text);
    line-height: 1.8;
    font-size: 1.0625rem;
  }

  .prose :global(h1),
  .prose :global(h2),
  .prose :global(h3),
  .prose :global(h4) {
    color: var(--color-text);
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    scroll-margin-top: 100px;
  }

  .prose :global(h2) {
    font-size: 1.875rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border);
  }

  .prose :global(h3) {
    font-size: 1.5rem;
  }

  .prose :global(h4) {
    font-size: 1.25rem;
  }

  .prose :global(p) {
    margin-bottom: 1.5rem;
    color: var(--color-text-secondary);
  }

  .prose :global(a) {
    color: var(--color-accent);
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: all 0.2s;
  }

  .prose :global(a:hover) {
    text-decoration-thickness: 2px;
  }

  .prose :global(strong) {
    color: var(--color-text);
    font-weight: 600;
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1.5rem;
    padding-left: 1.75rem;
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
    color: var(--color-text-secondary);
  }

  .prose :global(li::marker) {
    color: var(--color-accent);
  }

  /* Code Blocks */
  .prose :global(.code-block-wrapper) {
    position: relative;
    margin: 2rem 0;
  }

  .prose :global(pre) {
    background: #1e293b;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    overflow-x: auto;
    font-size: 0.875rem;
    line-height: 1.7;
  }

  :global([data-theme="light"]) .prose :global(pre) {
    background: #f8fafc;
  }

  .prose :global(pre code) {
    background: none;
    border: none;
    padding: 0;
    font-family: var(--font-mono);
    color: #e2e8f0;
    font-size: inherit;
  }

  :global([data-theme="light"]) .prose :global(pre code) {
    color: #334155;
  }

  .prose :global(code) {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 0.2em 0.4em;
    font-family: var(--font-mono);
    font-size: 0.875em;
    color: var(--color-accent);
  }

  .prose :global(pre code) {
    background: none;
    border: none;
    padding: 0;
  }

  /* Code Copy Button */
  .prose :global(.code-copy-btn) {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.75rem;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    color: #cbd5e1;
    font-size: 0.8125rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    backdrop-filter: blur(8px);
  }

  :global([data-theme="light"]) .prose :global(.code-copy-btn) {
    background: rgba(255, 255, 255, 0.9);
    border-color: var(--color-border);
    color: var(--color-text-secondary);
  }

  .prose :global(.code-copy-btn:hover) {
    background: rgba(0, 0, 0, 0.5);
    border-color: rgba(255, 255, 255, 0.2);
    color: white;
  }

  :global([data-theme="light"]) .prose :global(.code-copy-btn:hover) {
    background: white;
    border-color: var(--color-accent);
    color: var(--color-accent);
  }

  .prose :global(.code-copy-btn.copied) {
    background: rgba(34, 197, 94, 0.2);
    border-color: rgba(34, 197, 94, 0.3);
    color: #22c55e;
  }

  /* Blockquote */
  .prose :global(blockquote) {
    margin: 2rem 0;
    padding: 1.25rem 1.5rem;
    background: var(--color-bg-secondary);
    border-left: 4px solid var(--color-accent);
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
  }

  .prose :global(blockquote p) {
    margin: 0;
    font-style: italic;
  }

  /* Images */
  .prose :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-lg);
    margin: 2rem 0;
    box-shadow: var(--shadow-lg);
  }

  /* Mermaid Diagrams */
  .prose :global(.mermaid-diagram) {
    margin: 2rem 0;
    padding: 2rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow-x: auto;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .prose :global(.mermaid) {
    width: 100%;
    min-height: 300px;
  }

  .prose :global(.mermaid svg) {
    width: 100% !important;
    height: auto !important;
    max-width: none !important;
  }

  /* Mermaid ë‹¤ì´ì–´ê·¸ë¨ ë‚´ë¶€ ìš”ì†Œ í¬ê¸° ì¡°ì • */
  .prose :global(.mermaid .node rect),
  .prose :global(.mermaid .node circle),
  .prose :global(.mermaid .node ellipse),
  .prose :global(.mermaid .node polygon) {
    stroke-width: 2px;
  }

  .prose :global(.mermaid .edgeLabel) {
    font-size: 14px;
  }

  .prose :global(.mermaid .nodeLabel) {
    font-size: 16px;
  }

  /* Notion Callout */
  .prose :global(.notion-callout) {
    display: flex;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    margin: 1.5rem 0;
    border-radius: var(--radius-lg);
    border-left: 4px solid;
    background: var(--color-bg-secondary);
  }

  .prose :global(.notion-callout-gray) {
    border-left-color: #9ca3af;
    background: rgba(156, 163, 175, 0.1);
  }

  .prose :global(.notion-callout-blue) {
    border-left-color: #3b82f6;
    background: rgba(59, 130, 246, 0.1);
  }

  .prose :global(.notion-callout-green) {
    border-left-color: #22c55e;
    background: rgba(34, 197, 94, 0.1);
  }

  .prose :global(.notion-callout-yellow) {
    border-left-color: #eab308;
    background: rgba(234, 179, 8, 0.1);
  }

  .prose :global(.notion-callout-red) {
    border-left-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
  }

  .prose :global(.notion-callout-purple) {
    border-left-color: #a855f7;
    background: rgba(168, 85, 247, 0.1);
  }

  .prose :global(.callout-icon) {
    font-size: 1.5rem;
    flex-shrink: 0;
    line-height: 1;
  }

  .prose :global(.callout-text) {
    flex: 1;
    color: var(--color-text);
    line-height: 1.6;
  }

  /* Notion Toggle */
  .prose :global(.notion-toggle) {
    margin: 1.5rem 0;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    background: var(--color-bg-secondary);
  }

  .prose :global(.notion-toggle summary) {
    padding: 1rem 1.5rem;
    cursor: pointer;
    font-weight: 600;
    color: var(--color-text);
    list-style: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    user-select: none;
  }

  .prose :global(.notion-toggle summary::-webkit-details-marker) {
    display: none;
  }

  .prose :global(.notion-toggle summary::before) {
    content: 'â–¶';
    display: inline-block;
    transition: transform 0.2s;
    font-size: 0.75rem;
  }

  .prose :global(.notion-toggle[open] summary::before) {
    transform: rotate(90deg);
  }

  .prose :global(.notion-toggle summary:hover) {
    background: var(--color-bg);
  }

  .prose :global(.toggle-content) {
    padding: 0 1.5rem 1rem 2.5rem;
    color: var(--color-text-secondary);
  }

  /* Table ìŠ¤íƒ€ì¼ ê°œì„  */
  .prose :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    font-size: 0.9375rem;
    overflow: hidden;
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
  }

  .prose :global(thead) {
    background: var(--color-bg-secondary);
  }

  .prose :global(th) {
    padding: 0.875rem 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--color-text);
    border-bottom: 2px solid var(--color-border);
  }

  .prose :global(td) {
    padding: 0.875rem 1rem;
    border-bottom: 1px solid var(--color-border);
    color: var(--color-text-secondary);
  }

  .prose :global(tbody tr:last-child td) {
    border-bottom: none;
  }

  .prose :global(tbody tr:hover) {
    background: var(--color-bg-secondary);
  }

  /* Author Profile */
  .post-author {
    margin-top: 4rem;
    padding: 2rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .author-avatar {
    font-size: 3rem;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .author-info h3 {
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }

  .author-info p {
    margin: 0;
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  /* Footer */
  .post-footer {
    max-width: 768px;
    margin: 0 auto;
    padding: 3rem 1.5rem 4rem;
  }

  .footer-container {
    text-align: center;
  }

  .share-section {
    margin-bottom: 2rem;
  }

  .share-section h3 {
    font-size: 1.125rem;
    margin-bottom: 1rem;
    color: var(--color-text);
  }

  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    color: var(--color-text);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .share-btn:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    transform: translateY(-2px);
  }

  .back-to-list {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    color: var(--color-accent);
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }

  .back-to-list:hover {
    border-color: var(--color-accent);
    background: var(--color-bg-secondary);
    transform: translateX(-4px);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .post-header {
      padding: 2rem 1rem;
    }

    .post-content {
      padding: 1.5rem 1rem 3rem;
    }

    .post-footer {
      padding: 2rem 1rem 3rem;
    }

    .post-author {
      flex-direction: column;
      text-align: center;
    }
  }

  /* Animation */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

